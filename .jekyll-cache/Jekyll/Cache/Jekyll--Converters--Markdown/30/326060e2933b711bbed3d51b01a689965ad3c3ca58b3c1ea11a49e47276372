I"∏*<p>Currently, I‚Äôm working for both Pacific Northwest National Laboratory and Marcraft, an Educational Technologies Group company. For both jobs recently, I had the opportunity to set up multiple web servers in Linux. For one of these projects I also set up a whole LAMP stack and the Damn Vulnerable Web Application (DVWA), but I wanted to customize it with a new look. I also wanted to have a fake front end website that has a link for ‚Äúemployees‚Äù to login with, which would take them to the DVWA login page.</p>

<p>For starters, I‚Äôm most familiar with Ubuntu and CentOS 7, so I started this project in Ubuntu (not Ubuntu Server, which was probably a mistake). I tried and failed probably 5 times to get MySQL or MariaDB set up! So then I used CentOS 7 and it worked. Soon I‚Äôll do it all again either with CentOS Stream or with Rocky, but for now it‚Äôs CentOS 7.</p>

<p>A few things to note:</p>
<ul>
  <li>Somebody else created the web files for the front end for me, I just added them to the right directories.</li>
  <li>I‚Äôm working on a Windows 10 machine running VirtualBox and building the server on a VM</li>
  <li>I‚Äôm writing this as a step-by-step tutorial</li>
  <li>Turns out the boss wanted the VM on Hyper-V, so there‚Äôs instructions for how to convert it for Hyper-V</li>
</ul>

<p>Alright, here we go!</p>

<hr />

<ol>
  <li>Download the VirtualBox OVA file from <a href="https://www.linuxvmimages.com/images/centos-7">Linux Images</a></li>
  <li>Import the VM from the OVA file
    <ul>
      <li>Open VirtualBox and click File &gt; Import Appliance</li>
      <li>Click the Browse icon and locate the OVA file, then click Import</li>
    </ul>
  </li>
  <li>Change the Network Adapter
    <ul>
      <li>Open the VM Settings</li>
      <li>Click Network, then select NAT from the Attached to: dropdown menu</li>
      <li>Click the right-pointing arrow next to Advanced, then click Port Forwarding</li>
      <li>Click the icon to add two new rules, then use the variables in the table below:</li>
    </ul>

    <table>
      <thead>
        <tr>
          <th style="text-align: left">Name</th>
          <th style="text-align: left">Protocol</th>
          <th style="text-align: left">Host IP</th>
          <th style="text-align: left">Host Port</th>
          <th style="text-align: left">Guest IP</th>
          <th style="text-align: left">Guest Port</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="text-align: left">HTTP</td>
          <td style="text-align: left">TCP</td>
          <td style="text-align: left">127.0.0.1</td>
          <td style="text-align: left">80</td>
          <td style="text-align: left">10.0.2.15</td>
          <td style="text-align: left">80</td>
        </tr>
        <tr>
          <td style="text-align: left">SSH</td>
          <td style="text-align: left">TCP</td>
          <td style="text-align: left">127.0.0.1</td>
          <td style="text-align: left">22</td>
          <td style="text-align: left">10.0.2.15</td>
          <td style="text-align: left">22</td>
        </tr>
      </tbody>
    </table>

    <ul>
      <li>Click OK, then click OK again</li>
    </ul>
  </li>
  <li>Take a snapshot
    <ul>
      <li>With the VM highlighted, click the icon on the right side with 3 dots and horizontal lines, then click Snapshots</li>
      <li>On the new screen, click Take, then give it a name such as Fresh Install, then any comments if you wish</li>
    </ul>
  </li>
  <li>Start the VM and login with the following credentials:
    <ul>
      <li>User: centos</li>
      <li>Password: centos</li>
    </ul>
  </li>
  <li>Update the repositories</li>
</ol>

<pre><code><span style="color:rgba(255, 255, 255, 0.5)">$</span> sudo yum update</code></pre>

<ol>
  <li>Install Nano: sudo yum install nano</li>
  <li>Install Git: sudo yum install git</li>
  <li>Install Apache: sudo yum install httpd</li>
  <li>Start the Apache service: sudo systemctl start httpd.service</li>
  <li>Allow the service to start automatically on reboot: sudo systemctl enable httpd.service</li>
  <li>Install MariaDB: sudo yum install mariadb-server mariadb</li>
  <li>Start the database service: sudo systemctl start mariadb</li>
  <li>Run the MySQL security script: sudo mysql_secure_installation
‚Ä¢	When prompted for root password, simply press ENTER
‚Ä¢	When asked to if you want to create a root password, enter y, then enter a password
‚Ä¢	Press y at each prompt to remove some sample users and databases and disable remote root logins</li>
  <li>Enable MariaDB to start on boot: sudo systemctl enable mariadb.service</li>
  <li>Install PHP: sudo yum install php php-mysql</li>
  <li>Restart the Apache service: sudo systemctl restart httpd.service</li>
  <li>Install the PHP-GD module: sudo yum install php-gd</li>
  <li>Open MariaDB to create the DVWA database: mysql -u root -p
‚Ä¢	Enter the password you entered in step 12b above</li>
  <li>Create the database: create database dvwadb;
‚Ä¢	This can be any name, but whatever you use, take note ‚Äì it must match a configuration file later on</li>
  <li>Create DVWA database user with all the privileges assigned on the DVWA database: grant all on dvwadb.* to dvwamgr@localhost identified by ‚Äòmypassword‚Äô;
‚Ä¢	Again, the username (dvwamgr) and password (mypassword) can be whatever, as long as you take note of it and match it to the config file</li>
  <li>Reload the privileges table: flush privileges;</li>
  <li>Exit: quit</li>
  <li>Open the php.ini file for editing: sudo nano /etc/php.ini</li>
  <li>Edit the specified lines as necessary:
‚Ä¢	allow_url_fopen = On
‚Ä¢	allow_url_include = On</li>
  <li>Press ctrl+x, then y, then ENTER to exit and save changes</li>
  <li>Change directory: cd /var/www/html</li>
  <li>Download the DVWA files: sudo git clone https://github.com/ethicalhack3r/DVWA</li>
  <li>Change directory: cd /var/www/html/DVWA/config</li>
  <li>Rename the sample configuration file: sudo cp config.inc.php.dist config.inc.php</li>
  <li>Open the config file for editing: sudo nano config.inc.php</li>
  <li>Edit the following variables to match the database variables from above, then save and exit:
‚Ä¢	‚Äòdb_database‚Äô
‚Ä¢	‚Äòdb_user‚Äô
‚Ä¢	‚Äòdb_password‚Äô</li>
  <li>Restart the database and web services: sudo systemctl restart mariadb httpd</li>
  <li>Configure SELinux with the following commands:
‚Ä¢	sudo setsebool -P httpd_unified 1
‚Ä¢	sudo setsebool -P httpd_can_network_connect 1
‚Ä¢	sudo setsebool -P httpd_can_network_connect_db 1</li>
  <li>Give Apache ownership of all web server files: sudo chown -R apache:apache /var/www/html</li>
  <li>On the host, navigate to 127.0.0.1/DVWA in a web browser</li>
  <li>
    <p>On the Server Check screen, make sure the only variables in red are the same as the ones displayed in the screenshot (reCAPTCHA key, allow_url_fopen = On, and allow_url_include = On)</p>
  </li>
  <li>Click the Create / Reset Database button. When the page refreshes, it will take you to the login page</li>
  <li>On the VM, change directory: cd /var/www/html/DVWA/dvwa/images</li>
  <li>Rename the login logos: 
‚Ä¢	sudo mv login_logo.png login_logo.png.bak
‚Ä¢	sudo mv logo.png logo.png.bak</li>
  <li>On the host, open WinSCP and login to the VM</li>
  <li>Copy the logo.png file from the host machine to the home directory of the VM</li>
  <li>On the VM, you should still be in the /var/www/html/DVWA/dvwa/images directory</li>
  <li>Move the logo.png file to the directory: sudo mv ~/logo.png ./</li>
  <li>Copy the logo.png file as login_logo.png: sudo cp logo.png login_logo.png</li>
  <li>Change directory: cd /var/www/html/DVWA/dvwa/includes</li>
  <li>Change the display size of the logo.png image:
‚Ä¢	Open a config file for editing: sudo nano dvwaPage.inc.php
‚Ä¢	On line 302 (press alt+c to display line numbers), add width="150"  to the line so that it reads:
&lt;img src="‚Äù . DVWA_WEB_PAGE_TO_ROOT . ‚Äúdvwa/images/logo.png" alt="Damn Vulnerable Web Application\‚Äù width="150" /&gt;</li>
  <li>Change directory: cd /var/www/html/DVWA</li>
  <li>Change the display size of the login_logo.png image:
‚Ä¢	Open a config file for editing: sudo nano login.php
‚Ä¢	On line 83, add width="150"  to the line so that it reads:</li>
</ol>
<p>&lt;img src=\"" . DVWA_WEB_PAGE_TO_ROOT . "dvwa/images/login_logo.png\" width=\"300\" /&gt;</p>
<ol>
  <li>Open the CSS file for editing: sudo nano /var/www/DVWA/dvwa/css/main.css</li>
  <li>Edit the color scheme as follows:
‚Ä¢	Line 19: color: #ac2424;
‚Ä¢	Line 121: background: #ac2424;
‚Ä¢	Line 122: border-bottom: #2f1912;
‚Ä¢	Line 171: background-color: #ac2424;
‚Ä¢	Line 195: border-top: 5px solid #ac2424;</li>
  <li>Use WinSCP from the host to copy the folder containing the ACME web files to the home directory of the VM</li>
  <li>Copy the ACME web files to the Apache directory: sudo cp -R ~/ACME/* /var/www/html/</li>
  <li>Change directory: cd /var/www/html/DVWA/dvwa/includes</li>
  <li>Open a config file to change the button names: sudo nano dvwaPage.inc.php</li>
  <li>Edit the button ‚Äúnames‚Äù according to the table below, modifying only the parts highlighted in the example.
‚Ä¢	Note: The first button, Brute Force, is on Line 199
Original line:
$menuBlocks[ ‚Äòvulnerabilities‚Äô ][] = array( ‚Äòid‚Äô =&gt; ‚Äòbrute‚Äô, ‚Äòname‚Äô =&gt; ‚ÄòBrute Force‚Äô, ‚Äòurl‚Äô =&gt; ‚Äòvulnerabilities/brute/‚Äô );
Modified line:
$menuBlocks[ ‚Äòvulnerabilities‚Äô ][] = array( ‚Äòid‚Äô =&gt; ‚Äòbrute‚Äô, ‚Äòname‚Äô =&gt; Admin Login‚Äô, ‚Äòurl‚Äô =&gt; ‚Äòvulnerabilities/brute/‚Äô );</li>
</ol>

<p>Button Table
Original	Modified
Brute Force	Administrator Login
Command Injection	Network Tool
CSRF	
File Inclusion	
File Upload	
Insecure CAPTCHA	
SQL Injection	ACME Catalog
SQL Injection (Blind)	‚Äî
Weak Session IDs	
XSS (DOM)	
XSS (Reflected)	
XSS (Stored)	
CSP Bypass	
Javascript	
The Modified values in this table are only suggestions. You will need to come up with ideas for the rest.</p>
<ol>
  <li>If desired, type up the text for a replacement message of the DVWA homepage</li>
  <li>Change directory: cd /var/www/html/DVWA</li>
  <li>Make a backup copy of the index.php file: sudo cp index.php index.php.bak</li>
  <li>On the host, use WinSCP to pull a copy of the index.php file to the host.</li>
  <li>On the VM, delete the index.php file: sudo rm index.php</li>
  <li>On the host, open the file in a text editor such as Notepad, Notepad+, or Visual Studio Code, then edit it with the replacement message, being careful to use the appropriate html tags and to not delete necessary portions.</li>
  <li>Using WinSCP, copy the modified index.php file back to the /var/www/html/DVWA directory on the VM</li>
  <li>Shutdown the VM: shutdown now</li>
  <li>Take another snapshot, giving it a relevant name</li>
  <li>Export and convert the VM for Hyper-V, using the directions here: https://kags.me.ke/post/virtualbox-to-hyper-v/</li>
</ol>

:ET